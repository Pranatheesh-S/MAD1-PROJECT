{% extends 'layout.html' %}

{% block styles %}
<style>
    .slot-grid {
        display: grid;
        /* Define 3 columns: Date, Slot 1, Slot 2 */
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        align-items: center;
    }
    .slot-date {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        text-align: center;
        background-color: #f8f9fa;
        font-weight: bold;
    }
    .slot-time {
        padding: 10px;
        border: 2px solid;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
    }
    /* Green slot, based on your wireframe */
    .slot-available {
        border-color: #198754; /* Green */
        color: #198754;
        cursor: pointer;
        transition: background-color 0.2s, box-shadow 0.2s;
    }
    .slot-available:hover {
        background-color: #f0fff8;
    }
    /* Red slot, based on your wireframe */
    .slot-unavailable {
        border-color: #dc3545; /* Red */
        color: #dc3545;
        background-color: #fdf2f3;
        text-decoration: line-through;
        opacity: 0.6;
    }
    /* Blue selected slot, based on your wireframe */
    .slot-selected {
        border-color: #0d6efd; /* Blue */
        background-color: #e7f0ff;
        box-shadow: 0 0 8px rgba(13,110,253,0.5);
        transform: scale(1.02);
    }
</style>
{% endblock %}


{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Doctor's Availability</h3>
    <div>
        <a href="{{ url_for('doctor_detail', doctor_id=doctor.id) }}" class="btn btn-secondary btn-sm">Go Back</a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h4 class="card-title">with {{ doctor.name }}</h4>
        <h6 class="card-subtitle mb-4 text-muted">{{ doctor.specialization }}</h6>
        
        <form method="POST" action="{{ url_for('book_appointment', doctor_id=doctor.id) }}" id="booking-form">
            
            <input type="hidden" id="selected_slot_input" name="selected_slot" value="" required>

            <div class="slot-grid">
                {% for day_data in availability_data %}
                    
                    <div class="slot-date">
                        {{ day_data.date.strftime('%d/%m/%Y') }}
                    </div>
                    
                    {% for slot in day_data.slots %}
                        {% if slot.is_booked %}
                            <div class="slot-time slot-unavailable">
                                {{ slot.time.strftime('%I:%M %p') }}
                            </div>
                        {% else %}
                            <div class="slot-time slot-available" 
                                 data-value="{{ day_data.date.isoformat() }}_{{ slot.time.isoformat() }}">
                                {{ slot.time.strftime('%I:%M %p') }}
                            </div>
                        {% endif %}
                    {% endfor %}

                {% endfor %}
            </div>

            <hr>
            <button type="submit" id="book-button" class="btn btn-success" disabled>Book Selected Slot</button>
            <small id="book-help" class="form-text text-muted ms-2">Please select an available slot (green) to book.</small>
        </form>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script>
    // Wait for the page to load
    document.addEventListener('DOMContentLoaded', function() {
        
        // Get all the important elements
        const form = document.getElementById('booking-form');
        const hiddenInput = document.getElementById('selected_slot_input');
        const bookButton = document.getElementById('book-button');
        const bookHelp = document.getElementById('book-help');
        
        // Get all clickable (green) slots
        const availableSlots = document.querySelectorAll('.slot-available');
        
        // Add a click listener to each available slot
        availableSlots.forEach(function(slot) {
            slot.addEventListener('click', function() {
                
                // 1. Remove 'selected' class from all other slots
                availableSlots.forEach(s => s.classList.remove('slot-selected'));
                
                // 2. Add 'selected' class (blue border) to the clicked slot
                this.classList.add('slot-selected');
                
                // 3. Get the slot's value (e.g., "2025-11-10_08:00:00")
                const slotValue = this.getAttribute('data-value');
                
                // 4. Update the hidden input's value
                hiddenInput.value = slotValue;
                
                // 5. Enable the "Book" button and hide the help text
                bookButton.disabled = false;
                bookHelp.style.display = 'none';
            });
        });
    });
</script>
{% endblock %}