<!DOCTYPE html>
<html>
<head>
    <title>Doctors' Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #ffffff; font-family: sans-serif; }
        .dashboard-container {
            max-width: 900px; margin: 40px auto;
            border: 2px solid #333; border-radius: 4px; overflow: hidden;
        }
        .dashboard-header {
            border-bottom: 2px solid #333; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .dashboard-body { padding: 20px; }
        .custom-table { border: 2px solid #333; width: 100%; margin-bottom: 20px; }
        .custom-table thead th { border-bottom: 2px solid #333; padding: 8px; }
        .custom-table tbody td { padding: 12px 8px; border-bottom: 1px solid #ccc; vertical-align: middle;}
        
        .btn-update { border: 2px solid #0d6efd; color: #0d6efd; background: transparent; font-weight: 600; padding: 4px 20px; text-decoration: none; display: inline-block;}
        .btn-update:hover { background: #0d6efd; color: white; }

        .btn-mark-complete { border: 2px solid #198754; color: #198754; background: transparent; font-weight: 600; padding: 4px 10px; }
        .btn-mark-complete:hover { background: #198754; color: white; }

        .btn-cancel-custom { border: 2px solid #dc3545; color: #dc3545; background: transparent; font-weight: 600; padding: 4px 10px; }
        .btn-cancel-custom:hover { background: #dc3545; color: white; }

        .assigned-patient-box {
            border: 2px solid #6c757d; padding: 10px 15px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; border-radius: 4px;
        }
        .btn-view { border: 2px solid #0d6efd; color: #0d6efd; background: transparent; padding: 2px 20px; font-weight: 600; text-decoration: none;}
        .btn-view:hover { background: #0d6efd; color: white; }
        
        .btn-availability {
            border: 2px solid #198754; color: #198754; background-color: #e8f5e9;
            font-weight: 600; padding: 8px 20px; text-decoration: none;
        }
        .btn-availability:hover { background-color: #198754; color: white; }
    </style>
</head>
<body>

    <h2 class="text-center mt-4" style="color: #444;">Doctors' Dashboard</h2>
    <div class="dashboard-container">
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} m-0 rounded-0">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="dashboard-header">
            <h5 class="m-0">Welcome Dr. {{ doctor.name }}</h5>
            <a href="{{ url_for('logout') }}" class="text-dark fw-bold text-decoration-none">logout</a>
        </div>

        <div class="dashboard-body">
            <h5 class="mb-3">Upcoming Appointments</h5>
            {% if appointments %}
            <div class="table-responsive">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th width="10%">Sr No.</th>
                            <th width="25%">Patient Name</th>
                            <th width="20%">Patient History</th>
                            <th width="45%" class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appt in appointments %}
                        <tr>
                            <td>{{ loop.index }}.</td>
                            <td>{{ appt.patient.name }}</td>
                            <td>
                                <a href="{{ url_for('update_treatment', appt_id=appt.id) }}" class="btn-update">update</a>
                            </td>
                            <td>
                                <div class="d-flex justify-content-center gap-2">
                                    <form method="POST" action="{{ url_for('mark_complete', appt_id=appt.id) }}">
                                        <button type="submit" class="btn btn-sm btn-mark-complete">mark as complete</button>
                                    </form>
                                    <form method="POST" action="{{ url_for('cancel_appointment', appt_id=appt.id) }}">
                                        <button type="submit" class="btn btn-sm btn-cancel-custom">cancel</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <p>No upcoming appointments.</p>
            {% endif %}

            <h5 class="mt-4 mb-3">Assigned Patients (Completed Treatments)</h5>
            
            {% if assigned_patients %}
                {% for patient in assigned_patients %}
                <div class="assigned-patient-box">
                    <span class="text-muted fw-bold">{{ patient.name }}</span>
                    <a href="{{ url_for('doctor_patient_history', patient_id=patient.id) }}" class="btn-view">view</a>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No patients have completed treatments yet.</p>
            {% endif %}
            
            <div class="d-flex justify-content-end mt-4">
                <a href="{{ url_for('provide_availability') }}" class="btn-availability">Provide Availibility</a>
            </div>
        </div>
    </div>
</body>
</html>